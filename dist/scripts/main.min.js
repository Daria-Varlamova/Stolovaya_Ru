"use strict" 
let body = document.querySelector("body");
let burger = body.querySelector(".burger-menu");
let navList = body.querySelector(".menu-nav__list");
let menuNavItem = body.querySelectorAll('.menu-nav__item');

console.log(menuNavItem)

function toggleMenu () {
   body.classList.toggle("open-menu");
}

burger.addEventListener("click", toggleMenu);

for (let i = 0; i < menuNavItem.length; i ++) {
   menuNavItem[i].addEventListener('click' , function  (){
      body.classList.remove("open-menu");
   })
};const mesureWidth = (item) => {
    let reqItemWidth = 0;
    
    const screenWidth = $(window).width();
    const container = item.closest(".colors-acco");
    const titlesBlocks = container.find(".colors-acco__trigger");
    const titlesWidth = titlesBlocks.width() * titlesBlocks.length;

    const textContainer = item.find(".colors-acco__container");
    const paddingLeft = parseInt(textContainer.css("padding-left"));
    const paddingRight = parseInt(textContainer.css("padding-right"));

    const isMobile = window.matchMedia("(max-width: 768px)").matches;
    

    if (isMobile) {
        reqItemWidth = screenWidth - titlesWidth;
    } else {
        reqItemWidth = 500;
    }

    return {
        container: reqItemWidth,
        textContainer: reqItemWidth - paddingLeft - paddingRight
    }
};

const closeEveryItemInContainer = container => {
    const items = container.find(".colors-acco__item");
    const content = container.find(".colors-acco__content");

    items.removeClass("active");
    content.width(0);
}

const OPENItem = item => {
    const hidenContent = item.find(".colors-acco__content");
    const reqWidth = mesureWidth(item);
    const textBlock = item.find(".colors-acco__container");

    item.addClass("active");
    hidenContent.width(reqWidth.container);
    textBlock.width(reqWidth.textContainer)
}


$(".colors-acco__trigger").on("click", e => {
    e.preventDefault();

    const $this = $(e.currentTarget);
    const item = $this.closest(".colors-acco__item");
    const itemOpend = item.hasClass("active");
    const container = $this.closest(".colors-acco");

    if (itemOpend) {
        closeEveryItemInContainer(container);
    } else {
        closeEveryItemInContainer(container);
        OPENItem(item);
    }
});

$(".colors-acco__close").on("click", e => {
    e.preventDefault();
    closeEveryItemInContainer($(".colors-acco"));
});;const validateFields = (form, fieldsArray) => {
    fieldsArray.forEach((field) => {
        field.removeClass("input-error");
        const val = field.val();
        if (val.trim() === "") {
            field.addClass("input-error");
        }
    });

    const errorFields = form.find(".input-error");
    const isErrors = errorFields.length === 0;
    return isErrors;
}

$('.form').submit(e => {
    e.preventDefault();

    const form = $(e.currentTarget);
    const name = form.find("[name='name']");
    const phone = form.find("[name='phone']");
    const comment = form.find("[name='comment']");
    const to = form.find("[name='to']");

    const modal = $("#modal");
    const content = modal.find(".modal__title");

    modal.removeClass("error-modal");

    const isValid = validateFields(form, [name, phone, comment, to]);

    if (isValid) {
        $.ajax({
            url: "https://webdev-api.loftschool.com/sendmail/",
            method: "post",
            data: {
                name: name.val(),
                phone: phone.val(),
                comment: comment.val(),
                to: to.val()
            },
            success: (data) => {
                content.text(data.message);
                $.fancybox.open({
                    src: "#modal",
                    type: "inline"
                });
            },
            error: data => {

                console.log(data);
                const message = data.responseJSON.message;
                content.text(message);
                modal.addClass("error-modal");

                $.fancybox.open({
                    src: "#modal",
                    type: "inline"
                });
            }

        });
    }
});

$(".app-submit-btn").click(e => {
    e.preventDefault();

    $.fancybox.close();
});const sections = $("section");
const display = $(".maincontent");

sections.first().addClass('active');

let inScroll = false;

const performTransition = sectionEq => {
    if (inScroll) { return; }

    inScroll = true;

    const position = sectionEq * -100;

    display.css({
        transform : `translateY(${position}%)`
    });

    sections.eq(sectionEq).addClass('active').siblings().removeClass('active');

    setTimeout(() => {
        inScroll = false;

        const currentSection = sections.eq(sectionEq);
        const menuTheme = currentSection.attr('data-sidemenu-theme');
        const sideMenu = $('.fixed-menu');

        sideMenu
            .find('.fixed-menu__item--active a')
            .css({ borderColor: 'transparent' });
        sideMenu
            .find('.fixed-menu__item--active .menu-link-dot-decoration')
            .css({ backgroundColor: '#C4C4C4' });

        sideMenu
            .find('.fixed-menu__item')
            .eq(sectionEq)
            .addClass('fixed-menu__item--active')
            .siblings()
            .removeClass('fixed-menu__item--active');

        const sideMenuActiveLink = $('.fixed-menu__item--active a');
        const sideMenuActiveLinkDot = $('.fixed-menu__item--active .menu-link-dot-decoration');

        sideMenuActiveLink.css({ borderColor: menuTheme });
        sideMenuActiveLinkDot.css({ backgroundColor: menuTheme })

    }, 1300);
}

const scrollViewport = (direction) => {
    const activeSection = sections.filter('.active');
    const nextSection = activeSection.next();
    const prevSection = activeSection.prev();

    if (direction === 'next' && nextSection.length) {
        performTransition(nextSection.index());
    }
    if (direction === 'prev' && prevSection.length) {
        performTransition(prevSection.index());
    }
}

$(window).on("wheel", e => {

    const deltaY = e.originalEvent.deltaY;

    if (deltaY > 0) {
        scrollViewport('next');
    }

    if (deltaY < 0) {
        scrollViewport('prev');
    }

});

$(window).on('keydown', (e) => {
    const tagName = e.target.tagName.toLowerCase();

    if (tagName === 'input' || tagName === 'textarea') { return; }

    switch (e.keyCode) {
        case 38:
            scrollViewport('prev');
            break;
        case 40:
            scrollViewport('next');
            break;
    }
});

$('[data-scroll-to]').click((e) => {
    e.preventDefault();

    const $this = $(e.currentTarget);
    const target = $this.attr('data-scroll-to');
    const reqSection = $(`[data-section-index="${target}"]`);

    performTransition(reqSection.index());
});

$(function() {
    const md = new MobileDetect(window.navigator.userAgent);

    if (md.mobile()) {
        $('.wrapper').on('touchmove', (e) => e.preventDefault());

        $("body").swipe( {
            swipe: function(event, direction) {
                console.log(direction);

                if (direction === 'up') {
                    scrollViewport('next');
                }
                if (direction === 'down') {
                    scrollViewport('prev');
                }
            }
        });
    }
});; const slider = $('.slider__list').bxSlider({ pager: false, controls: false });
 
 $(".slider__btn--prev").click(e => {
     e.preventDefault();
     slider.goToPrevSlide();
 })

 $(".slider__btn--next").click(e => {
     e.preventDefault();
     slider.goToNextSlide();
 });const findBlockByAlias = (alias) => {
    return $(".reviews__item").filter((ndx, item) => {
        return $(item).attr("data-linked-with") === alias;
    });
};


$(".interactive-avatar__link").click((e) => {
    e.preventDefault();

    const $this = $(e.currentTarget);
    const target = $this.attr("data-open");
    const itemToShow = findBlockByAlias(target);
    const curItem =  $this.closest(".reviews__switcher-item");

    itemToShow.addClass("active").siblings().removeClass("active");
    curItem.addClass("active").siblings().removeClass("active");

});

;const openItem = (item) => {
    const container = item.closest(".team__item");
    const contentBlock = container.find(".team__details");
    const textBlock = contentBlock.find('.team__details-block');
    const reqHeight = textBlock.height();

    container.addClass("active");
    contentBlock.height(reqHeight);
};

const clouseEveryItem = (container) => {
    const items = container.find(".team__details");
    const itemContainer = container.find(".team__item");

    itemContainer.removeClass("active");
    items.height(0);
};

$(".team__title").click((e) => {
    const $this = $(e.currentTarget);
    const container = $this.closest(".team");
    const elemContainer = $this.closest(".team__item");

    if (elemContainer.hasClass("active")) {
       clouseEveryItem(container);
    } else {
        clouseEveryItem(container);
        openItem($this);
    }
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1cmdlck1lbnUuanMiLCJjb2xvcnNBY2NvcmRpb24uanMiLCJtb2RhbC5qcyIsIm9wcy5qcyIsInNsaWRlci5qcyIsInRhYnMuanMiLCJ0ZWFtQWNjb3JkaW9uLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0NwRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQ3pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCIgXHJcbmxldCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIik7XHJcbmxldCBidXJnZXIgPSBib2R5LnF1ZXJ5U2VsZWN0b3IoXCIuYnVyZ2VyLW1lbnVcIik7XHJcbmxldCBuYXZMaXN0ID0gYm9keS5xdWVyeVNlbGVjdG9yKFwiLm1lbnUtbmF2X19saXN0XCIpO1xyXG5sZXQgbWVudU5hdkl0ZW0gPSBib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tZW51LW5hdl9faXRlbScpO1xyXG5cclxuY29uc29sZS5sb2cobWVudU5hdkl0ZW0pXHJcblxyXG5mdW5jdGlvbiB0b2dnbGVNZW51ICgpIHtcclxuICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKFwib3Blbi1tZW51XCIpO1xyXG59XHJcblxyXG5idXJnZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRvZ2dsZU1lbnUpO1xyXG5cclxuZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51TmF2SXRlbS5sZW5ndGg7IGkgKyspIHtcclxuICAgbWVudU5hdkl0ZW1baV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snICwgZnVuY3Rpb24gICgpe1xyXG4gICAgICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJvcGVuLW1lbnVcIik7XHJcbiAgIH0pXHJcbn0iLCJjb25zdCBtZXN1cmVXaWR0aCA9IChpdGVtKSA9PiB7XHJcbiAgICBsZXQgcmVxSXRlbVdpZHRoID0gMDtcclxuICAgIFxyXG4gICAgY29uc3Qgc2NyZWVuV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdChcIi5jb2xvcnMtYWNjb1wiKTtcclxuICAgIGNvbnN0IHRpdGxlc0Jsb2NrcyA9IGNvbnRhaW5lci5maW5kKFwiLmNvbG9ycy1hY2NvX190cmlnZ2VyXCIpO1xyXG4gICAgY29uc3QgdGl0bGVzV2lkdGggPSB0aXRsZXNCbG9ja3Mud2lkdGgoKSAqIHRpdGxlc0Jsb2Nrcy5sZW5ndGg7XHJcblxyXG4gICAgY29uc3QgdGV4dENvbnRhaW5lciA9IGl0ZW0uZmluZChcIi5jb2xvcnMtYWNjb19fY29udGFpbmVyXCIpO1xyXG4gICAgY29uc3QgcGFkZGluZ0xlZnQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctbGVmdFwiKSk7XHJcbiAgICBjb25zdCBwYWRkaW5nUmlnaHQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctcmlnaHRcIikpO1xyXG5cclxuICAgIGNvbnN0IGlzTW9iaWxlID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWF4LXdpZHRoOiA3NjhweClcIikubWF0Y2hlcztcclxuICAgIFxyXG5cclxuICAgIGlmIChpc01vYmlsZSkge1xyXG4gICAgICAgIHJlcUl0ZW1XaWR0aCA9IHNjcmVlbldpZHRoIC0gdGl0bGVzV2lkdGg7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlcUl0ZW1XaWR0aCA9IDUwMDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNvbnRhaW5lcjogcmVxSXRlbVdpZHRoLFxyXG4gICAgICAgIHRleHRDb250YWluZXI6IHJlcUl0ZW1XaWR0aCAtIHBhZGRpbmdMZWZ0IC0gcGFkZGluZ1JpZ2h0XHJcbiAgICB9XHJcbn07XHJcblxyXG5jb25zdCBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyID0gY29udGFpbmVyID0+IHtcclxuICAgIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoXCIuY29sb3JzLWFjY29fX2l0ZW1cIik7XHJcbiAgICBjb25zdCBjb250ZW50ID0gY29udGFpbmVyLmZpbmQoXCIuY29sb3JzLWFjY29fX2NvbnRlbnRcIik7XHJcblxyXG4gICAgaXRlbXMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBjb250ZW50LndpZHRoKDApO1xyXG59XHJcblxyXG5jb25zdCBPUEVOSXRlbSA9IGl0ZW0gPT4ge1xyXG4gICAgY29uc3QgaGlkZW5Db250ZW50ID0gaXRlbS5maW5kKFwiLmNvbG9ycy1hY2NvX19jb250ZW50XCIpO1xyXG4gICAgY29uc3QgcmVxV2lkdGggPSBtZXN1cmVXaWR0aChpdGVtKTtcclxuICAgIGNvbnN0IHRleHRCbG9jayA9IGl0ZW0uZmluZChcIi5jb2xvcnMtYWNjb19fY29udGFpbmVyXCIpO1xyXG5cclxuICAgIGl0ZW0uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBoaWRlbkNvbnRlbnQud2lkdGgocmVxV2lkdGguY29udGFpbmVyKTtcclxuICAgIHRleHRCbG9jay53aWR0aChyZXFXaWR0aC50ZXh0Q29udGFpbmVyKVxyXG59XHJcblxyXG5cclxuJChcIi5jb2xvcnMtYWNjb19fdHJpZ2dlclwiKS5vbihcImNsaWNrXCIsIGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgaXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIuY29sb3JzLWFjY29fX2l0ZW1cIik7XHJcbiAgICBjb25zdCBpdGVtT3BlbmQgPSBpdGVtLmhhc0NsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5jb2xvcnMtYWNjb1wiKTtcclxuXHJcbiAgICBpZiAoaXRlbU9wZW5kKSB7XHJcbiAgICAgICAgY2xvc2VFdmVyeUl0ZW1JbkNvbnRhaW5lcihjb250YWluZXIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyKGNvbnRhaW5lcik7XHJcbiAgICAgICAgT1BFTkl0ZW0oaXRlbSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuJChcIi5jb2xvcnMtYWNjb19fY2xvc2VcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIoJChcIi5jb2xvcnMtYWNjb1wiKSk7XHJcbn0pOyIsImNvbnN0IHZhbGlkYXRlRmllbGRzID0gKGZvcm0sIGZpZWxkc0FycmF5KSA9PiB7XHJcbiAgICBmaWVsZHNBcnJheS5mb3JFYWNoKChmaWVsZCkgPT4ge1xyXG4gICAgICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICAgICAgY29uc3QgdmFsID0gZmllbGQudmFsKCk7XHJcbiAgICAgICAgaWYgKHZhbC50cmltKCkgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgZmllbGQuYWRkQ2xhc3MoXCJpbnB1dC1lcnJvclwiKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBlcnJvckZpZWxkcyA9IGZvcm0uZmluZChcIi5pbnB1dC1lcnJvclwiKTtcclxuICAgIGNvbnN0IGlzRXJyb3JzID0gZXJyb3JGaWVsZHMubGVuZ3RoID09PSAwO1xyXG4gICAgcmV0dXJuIGlzRXJyb3JzO1xyXG59XHJcblxyXG4kKCcuZm9ybScpLnN1Ym1pdChlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBjb25zdCBmb3JtID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgbmFtZSA9IGZvcm0uZmluZChcIltuYW1lPSduYW1lJ11cIik7XHJcbiAgICBjb25zdCBwaG9uZSA9IGZvcm0uZmluZChcIltuYW1lPSdwaG9uZSddXCIpO1xyXG4gICAgY29uc3QgY29tbWVudCA9IGZvcm0uZmluZChcIltuYW1lPSdjb21tZW50J11cIik7XHJcbiAgICBjb25zdCB0byA9IGZvcm0uZmluZChcIltuYW1lPSd0byddXCIpO1xyXG5cclxuICAgIGNvbnN0IG1vZGFsID0gJChcIiNtb2RhbFwiKTtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBtb2RhbC5maW5kKFwiLm1vZGFsX190aXRsZVwiKTtcclxuXHJcbiAgICBtb2RhbC5yZW1vdmVDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG5cclxuICAgIGNvbnN0IGlzVmFsaWQgPSB2YWxpZGF0ZUZpZWxkcyhmb3JtLCBbbmFtZSwgcGhvbmUsIGNvbW1lbnQsIHRvXSk7XHJcblxyXG4gICAgaWYgKGlzVmFsaWQpIHtcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsL1wiLFxyXG4gICAgICAgICAgICBtZXRob2Q6IFwicG9zdFwiLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgcGhvbmU6IHBob25lLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgY29tbWVudDogY29tbWVudC52YWwoKSxcclxuICAgICAgICAgICAgICAgIHRvOiB0by52YWwoKVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzdWNjZXNzOiAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29udGVudC50ZXh0KGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAkLmZhbmN5Ym94Lm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIHNyYzogXCIjbW9kYWxcIixcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImlubGluZVwiXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXJyb3I6IGRhdGEgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGRhdGEucmVzcG9uc2VKU09OLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50LnRleHQobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICBtb2RhbC5hZGRDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgc3JjOiBcIiNtb2RhbFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaW5saW5lXCJcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbiQoXCIuYXBwLXN1Ym1pdC1idG5cIikuY2xpY2soZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgJC5mYW5jeWJveC5jbG9zZSgpO1xyXG59KSIsImNvbnN0IHNlY3Rpb25zID0gJChcInNlY3Rpb25cIik7XHJcbmNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xyXG5cclxuc2VjdGlvbnMuZmlyc3QoKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcblxyXG5sZXQgaW5TY3JvbGwgPSBmYWxzZTtcclxuXHJcbmNvbnN0IHBlcmZvcm1UcmFuc2l0aW9uID0gc2VjdGlvbkVxID0+IHtcclxuICAgIGlmIChpblNjcm9sbCkgeyByZXR1cm47IH1cclxuXHJcbiAgICBpblNjcm9sbCA9IHRydWU7XHJcblxyXG4gICAgY29uc3QgcG9zaXRpb24gPSBzZWN0aW9uRXEgKiAtMTAwO1xyXG5cclxuICAgIGRpc3BsYXkuY3NzKHtcclxuICAgICAgICB0cmFuc2Zvcm0gOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSUpYFxyXG4gICAgfSk7XHJcblxyXG4gICAgc2VjdGlvbnMuZXEoc2VjdGlvbkVxKS5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgaW5TY3JvbGwgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgY29uc3QgY3VycmVudFNlY3Rpb24gPSBzZWN0aW9ucy5lcShzZWN0aW9uRXEpO1xyXG4gICAgICAgIGNvbnN0IG1lbnVUaGVtZSA9IGN1cnJlbnRTZWN0aW9uLmF0dHIoJ2RhdGEtc2lkZW1lbnUtdGhlbWUnKTtcclxuICAgICAgICBjb25zdCBzaWRlTWVudSA9ICQoJy5maXhlZC1tZW51Jyk7XHJcblxyXG4gICAgICAgIHNpZGVNZW51XHJcbiAgICAgICAgICAgIC5maW5kKCcuZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlIGEnKVxyXG4gICAgICAgICAgICAuY3NzKHsgYm9yZGVyQ29sb3I6ICd0cmFuc3BhcmVudCcgfSk7XHJcbiAgICAgICAgc2lkZU1lbnVcclxuICAgICAgICAgICAgLmZpbmQoJy5maXhlZC1tZW51X19pdGVtLS1hY3RpdmUgLm1lbnUtbGluay1kb3QtZGVjb3JhdGlvbicpXHJcbiAgICAgICAgICAgIC5jc3MoeyBiYWNrZ3JvdW5kQ29sb3I6ICcjQzRDNEM0JyB9KTtcclxuXHJcbiAgICAgICAgc2lkZU1lbnVcclxuICAgICAgICAgICAgLmZpbmQoJy5maXhlZC1tZW51X19pdGVtJylcclxuICAgICAgICAgICAgLmVxKHNlY3Rpb25FcSlcclxuICAgICAgICAgICAgLmFkZENsYXNzKCdmaXhlZC1tZW51X19pdGVtLS1hY3RpdmUnKVxyXG4gICAgICAgICAgICAuc2libGluZ3MoKVxyXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ2ZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZScpO1xyXG5cclxuICAgICAgICBjb25zdCBzaWRlTWVudUFjdGl2ZUxpbmsgPSAkKCcuZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlIGEnKTtcclxuICAgICAgICBjb25zdCBzaWRlTWVudUFjdGl2ZUxpbmtEb3QgPSAkKCcuZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlIC5tZW51LWxpbmstZG90LWRlY29yYXRpb24nKTtcclxuXHJcbiAgICAgICAgc2lkZU1lbnVBY3RpdmVMaW5rLmNzcyh7IGJvcmRlckNvbG9yOiBtZW51VGhlbWUgfSk7XHJcbiAgICAgICAgc2lkZU1lbnVBY3RpdmVMaW5rRG90LmNzcyh7IGJhY2tncm91bmRDb2xvcjogbWVudVRoZW1lIH0pXHJcblxyXG4gICAgfSwgMTMwMCk7XHJcbn1cclxuXHJcbmNvbnN0IHNjcm9sbFZpZXdwb3J0ID0gKGRpcmVjdGlvbikgPT4ge1xyXG4gICAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcignLmFjdGl2ZScpO1xyXG4gICAgY29uc3QgbmV4dFNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLm5leHQoKTtcclxuICAgIGNvbnN0IHByZXZTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5wcmV2KCk7XHJcblxyXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gJ25leHQnICYmIG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKG5leHRTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3ByZXYnICYmIHByZXZTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgfVxyXG59XHJcblxyXG4kKHdpbmRvdykub24oXCJ3aGVlbFwiLCBlID0+IHtcclxuXHJcbiAgICBjb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xyXG5cclxuICAgIGlmIChkZWx0YVkgPiAwKSB7XHJcbiAgICAgICAgc2Nyb2xsVmlld3BvcnQoJ25leHQnKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGVsdGFZIDwgMCkge1xyXG4gICAgICAgIHNjcm9sbFZpZXdwb3J0KCdwcmV2Jyk7XHJcbiAgICB9XHJcblxyXG59KTtcclxuXHJcbiQod2luZG93KS5vbigna2V5ZG93bicsIChlKSA9PiB7XHJcbiAgICBjb25zdCB0YWdOYW1lID0gZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgIGlmICh0YWdOYW1lID09PSAnaW5wdXQnIHx8IHRhZ05hbWUgPT09ICd0ZXh0YXJlYScpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgc3dpdGNoIChlLmtleUNvZGUpIHtcclxuICAgICAgICBjYXNlIDM4OlxyXG4gICAgICAgICAgICBzY3JvbGxWaWV3cG9ydCgncHJldicpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDQwOlxyXG4gICAgICAgICAgICBzY3JvbGxWaWV3cG9ydCgnbmV4dCcpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxufSk7XHJcblxyXG4kKCdbZGF0YS1zY3JvbGwtdG9dJykuY2xpY2soKGUpID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IHRhcmdldCA9ICR0aGlzLmF0dHIoJ2RhdGEtc2Nyb2xsLXRvJyk7XHJcbiAgICBjb25zdCByZXFTZWN0aW9uID0gJChgW2RhdGEtc2VjdGlvbi1pbmRleD1cIiR7dGFyZ2V0fVwiXWApO1xyXG5cclxuICAgIHBlcmZvcm1UcmFuc2l0aW9uKHJlcVNlY3Rpb24uaW5kZXgoKSk7XHJcbn0pO1xyXG5cclxuJChmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IG1kID0gbmV3IE1vYmlsZURldGVjdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcblxyXG4gICAgaWYgKG1kLm1vYmlsZSgpKSB7XHJcbiAgICAgICAgJCgnLndyYXBwZXInKS5vbigndG91Y2htb3ZlJywgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7XHJcblxyXG4gICAgICAgICQoXCJib2R5XCIpLnN3aXBlKCB7XHJcbiAgICAgICAgICAgIHN3aXBlOiBmdW5jdGlvbihldmVudCwgZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkaXJlY3Rpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd1cCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY3JvbGxWaWV3cG9ydCgnbmV4dCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2Rvd24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVmlld3BvcnQoJ3ByZXYnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTsiLCIgY29uc3Qgc2xpZGVyID0gJCgnLnNsaWRlcl9fbGlzdCcpLmJ4U2xpZGVyKHsgcGFnZXI6IGZhbHNlLCBjb250cm9sczogZmFsc2UgfSk7XHJcbiBcclxuICQoXCIuc2xpZGVyX19idG4tLXByZXZcIikuY2xpY2soZSA9PiB7XHJcbiAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgIHNsaWRlci5nb1RvUHJldlNsaWRlKCk7XHJcbiB9KVxyXG5cclxuICQoXCIuc2xpZGVyX19idG4tLW5leHRcIikuY2xpY2soZSA9PiB7XHJcbiAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgIHNsaWRlci5nb1RvTmV4dFNsaWRlKCk7XHJcbiB9KSIsImNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSAoYWxpYXMpID0+IHtcclxuICAgIHJldHVybiAkKFwiLnJldmlld3NfX2l0ZW1cIikuZmlsdGVyKChuZHgsIGl0ZW0pID0+IHtcclxuICAgICAgICByZXR1cm4gJChpdGVtKS5hdHRyKFwiZGF0YS1saW5rZWQtd2l0aFwiKSA9PT0gYWxpYXM7XHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG4kKFwiLmludGVyYWN0aXZlLWF2YXRhcl9fbGlua1wiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtb3BlblwiKTtcclxuICAgIGNvbnN0IGl0ZW1Ub1Nob3cgPSBmaW5kQmxvY2tCeUFsaWFzKHRhcmdldCk7XHJcbiAgICBjb25zdCBjdXJJdGVtID0gICR0aGlzLmNsb3Nlc3QoXCIucmV2aWV3c19fc3dpdGNoZXItaXRlbVwiKTtcclxuXHJcbiAgICBpdGVtVG9TaG93LmFkZENsYXNzKFwiYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBjdXJJdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcblxyXG59KTtcclxuXHJcbiIsImNvbnN0IG9wZW5JdGVtID0gKGl0ZW0pID0+IHtcclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdChcIi50ZWFtX19pdGVtXCIpO1xyXG4gICAgY29uc3QgY29udGVudEJsb2NrID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9fZGV0YWlsc1wiKTtcclxuICAgIGNvbnN0IHRleHRCbG9jayA9IGNvbnRlbnRCbG9jay5maW5kKCcudGVhbV9fZGV0YWlscy1ibG9jaycpO1xyXG4gICAgY29uc3QgcmVxSGVpZ2h0ID0gdGV4dEJsb2NrLmhlaWdodCgpO1xyXG5cclxuICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgIGNvbnRlbnRCbG9jay5oZWlnaHQocmVxSGVpZ2h0KTtcclxufTtcclxuXHJcbmNvbnN0IGNsb3VzZUV2ZXJ5SXRlbSA9IChjb250YWluZXIpID0+IHtcclxuICAgIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9fZGV0YWlsc1wiKTtcclxuICAgIGNvbnN0IGl0ZW1Db250YWluZXIgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19pdGVtXCIpO1xyXG5cclxuICAgIGl0ZW1Db250YWluZXIucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBpdGVtcy5oZWlnaHQoMCk7XHJcbn07XHJcblxyXG4kKFwiLnRlYW1fX3RpdGxlXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IGNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIudGVhbVwiKTtcclxuICAgIGNvbnN0IGVsZW1Db250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLnRlYW1fX2l0ZW1cIik7XHJcblxyXG4gICAgaWYgKGVsZW1Db250YWluZXIuaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcclxuICAgICAgIGNsb3VzZUV2ZXJ5SXRlbShjb250YWluZXIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjbG91c2VFdmVyeUl0ZW0oY29udGFpbmVyKTtcclxuICAgICAgICBvcGVuSXRlbSgkdGhpcyk7XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=
